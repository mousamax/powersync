replication:
  connections:
    - type: postgresql
      # Use the PowerSync user with replication privileges
      # In production, use environment variables for credentials
      uri: postgresql://powersync_role:powersync_secure_password_change_in_production@postgres-powersync:4321/postgres

      # SSL settings
      sslmode: disable # 'verify-full' (default) or 'verify-ca' or 'disable'

# Connection settings for sync bucket storage
storage:
  type: postgresql
  uri: postgresql://powersync_storage_user:powersync_secure_password_change_in_production@postgres-powersync:4321/postgres
  sslmode: disable # 'verify-full' (default) or 'verify-ca' or 'disable'

# The port which the PowerSync API server will listen on
port: 8080

# Specify sync rules
sync_rules:
  content: |
    bucket_definitions:
      # Family-specific data bucket
      family_data:
        # Extract familyId from JWT token
        parameters: SELECT request.jwt() ->> 'family_id' AS family_id
        data:
          - SELECT * FROM family WHERE id = bucket.family_id
          - SELECT * FROM member WHERE family_id = bucket.family_id
          - SELECT * FROM task_list WHERE family_id = bucket.family_id
          - SELECT * FROM task WHERE family_id = bucket.family_id

# Settings for client authentication
client_auth:
  # JWT configuration for HMAC (HS512)
  jwks:
    keys:
      - kty: 'oct'
        k: 'WW91clN1cGVyU2VjcmV0S2V5Rm9ySFM1MTJNdXN0QmVBdExlYXN0NjRCeXRlc0xvbmdGb3JTZWN1cml0eVB1cnBvc2VzMTIzNDU2Nzg5'
        alg: 'HS512'
        kid: 'powersync-hs512-key' # Must match the 'kid' in your JWT header exactly

  # JWKS audience
  audience: ['powersync-dev', 'powersync']

  # Settings for telemetry reporting
  # See https://docs.powersync.com/self-hosting/telemetry
  telemetry:
    # Opt out of reporting anonymized usage metrics to PowerSync telemetry service
    disable_telemetry_sharing: false